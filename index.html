<!DOCTYPE html>
<html>

<head>
    <title>Conector JSON GitHub para Tableau</title>
    <script src="https://connectors.tableau.com/libs/tableauwdc-2.3.latest.js"></script>
</head>

<body>
    <h2>Conector JSON para Tableau (via GitHub)</h2>
    <p>Insira a URL RAW do seu arquivo .json:</p>
    <input type="text" id="jsonUrl" size="100"
        value="https://raw.githubusercontent.com/Elwardz/upe-analytics-sandbox/main/financeiro_upe.json">
    <br><br>
    <button onclick="submit()">Conectar ao Tableau</button>

    <script>
        function getSchema(callback) {
            var cols = [
                { id: "id_pagamento", dataType: tableau.dataTypeEnum.string },
                { id: "trimestre_referencia", dataType: tableau.dataTypeEnum.string },
                { id: "data_pagamento", dataType: tableau.dataTypeEnum.string },
                { id: "nome_servidor", dataType: tableau.dataTypeEnum.string },
                { id: "genero", dataType: tableau.dataTypeEnum.string },
                { id: "idade", dataType: tableau.dataTypeEnum.int },
                { id: "campus", dataType: tableau.dataTypeEnum.string },
                { id: "cargo", dataType: tableau.dataTypeEnum.string },
                { id: "salario_base", dataType: tableau.dataTypeEnum.float },
                { id: "valor_liquido", dataType: tableau.dataTypeEnum.float },
                { id: "custo_total_upe", dataType: tableau.dataTypeEnum.float }
            ];

            var tableSchema = {
                id: "dadosFinanceirosUPE",
                alias: "Dados Financeiros da UPE (JSON)",
                columns: cols
            };

            callback([tableSchema]);
        }

        function getData(table, doneCallback) {
            var url = tableau.connectionData;
            fetch(url)
                .then(res => res.json())
                .then(data => {
                    table.appendRows(data);
                    doneCallback();
                });
        }

        function submit() {
            var url = document.getElementById("jsonUrl").value;
            tableau.connectionData = url;
            tableau.connectionName = "JSON GitHub para Tableau";
            tableau.submit();
        }

        var connector = tableau.makeConnector();
        connector.getSchema = getSchema;
        connector.getData = getData;
        tableau.registerConnector(connector);
    </script>
</body>

</html>